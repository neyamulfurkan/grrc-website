<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Panel - GSTU Robotics & Research Club">
    <title>Admin Panel - GSTU Robotics & Research Club</title>
    
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/components.css">
    
    <style>
        .admin-container {
            display: flex;
            min-height: 100vh;
            background: var(--background-color);
        }

        .admin-sidebar {
            width: 260px;
            background: var(--surface-color);
            border-right: 1px solid var(--border-color);
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .admin-logo {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
        }

        .admin-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .admin-subtitle {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .sidebar-nav {
            padding: var(--space-md);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            margin-bottom: var(--space-xs);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: var(--font-size-base);
        }

        .nav-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
            font-weight: var(--font-weight-semibold);
        }

        .nav-item-icon {
            margin-right: var(--space-sm);
            font-size: var(--font-size-lg);
        }

        .logout-btn {
            margin-top: var(--space-md);
            background: var(--error-color);
            color: white;
        }

        .logout-btn:hover {
            background: var(--error-dark);
            transform: translateX(4px);
        }

        .admin-main {
            flex: 1;
            margin-left: 260px;
            padding: var(--space-xl);
            transition: margin-left 0.3s ease;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
        }

        .admin-header h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--surface-color);
            border-radius: var(--radius-full);
            border: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
        }

        .mobile-sidebar-toggle {
            display: none;
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            width: 56px;
            height: 56px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: var(--font-size-xl);
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            z-index: 999;
        }

        .section-content {
            display: none;
        }

        .section-content.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            background: var(--surface-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .stat-icon {
            font-size: var(--font-size-3xl);
        }

        .stat-number {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary-color);
            margin-bottom: var(--space-xs);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-form {
            background: var(--surface-color);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            margin-bottom: var(--space-xl);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-color);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            transition: border-color 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
        }

        .file-input-label {
            display: inline-block;
            padding: var(--space-sm) var(--space-md);
            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .file-input-label:hover {
            background: var(--primary-dark);
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .image-preview {
            margin-top: var(--space-md);
            max-width: 200px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .data-table-wrapper {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--background-color);
            padding: var(--space-md);
            text-align: left;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: var(--space-md);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--background-color);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-xs);
        }

        .btn-icon {
            padding: var(--space-xs) var(--space-sm);
            font-size: var(--font-size-sm);
        }

        .btn-edit {
            background: var(--info-color);
            color: white;
        }

        .btn-delete {
            background: var(--error-color);
            color: white;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
        }

        .badge-success {
            background: var(--success-light);
            color: var(--success-dark);
        }

        .badge-warning {
            background: var(--warning-light);
            color: var(--warning-dark);
        }

        .badge-info {
            background: var(--info-light);
            color: var(--info-dark);
        }

        .badge-error {
            background: #fef2f2;
            color: #dc2626;
        }

        @media (max-width: 1023px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.mobile-open {
                transform: translateX(0);
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            }

            .admin-main {
                margin-left: 0;
                padding: var(--space-md);
            }

            .mobile-sidebar-toggle {
                display: flex !important;
                align-items: center;
                justify-content: center;
                visibility: visible !important;
                opacity: 1 !important;
            }

            .admin-header {
                flex-direction: column;
                gap: var(--space-md);
                align-items: flex-start;
            }
            
            .admin-header h1 {
                font-size: var(--font-size-2xl);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-md);
            }
        }

        @media (max-width: 767px) {
            .admin-main {
                padding: var(--space-sm);
            }

            .admin-form {
                padding: var(--space-md);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .data-table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .file-input-label {
                display: block;
                width: 100%;
                text-align: center;
                padding: var(--space-md);
                font-size: var(--font-size-base);
            }
            
            .btn-primary, .btn-secondary, .btn-outline {
                width: 100%;
                padding: var(--space-md);
                font-size: var(--font-size-base);
                margin-bottom: var(--space-xs);
            }

            .data-table {
                min-width: 600px;
                font-size: 0.875rem;
            }
            
            .admin-header h1 {
                font-size: var(--font-size-xl);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .stat-card {
                padding: var(--space-md);
            }
            
            .btn {
                width: 100%;
            }
        }

        .toast {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            padding: var(--space-md) var(--space-lg);
            background: var(--surface-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            border-left: 4px solid var(--success-color);
            display: none;
            align-items: center;
            gap: var(--space-sm);
            z-index: 10000;
            animation: slideInRight 0.3s ease;
        }

        .toast.show {
            display: flex;
        }

        .toast.error {
            border-left-color: var(--error-color);
        }

        .toast-message {
            color: var(--text-primary);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            padding: var(--space-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-color);
            min-height: 42px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 4px 12px;
            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
        }

        .tags-input {
            flex: 1;
            min-width: 120px;
            border: none;
            background: transparent;
            outline: none;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon">‚úì</span>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <div class="admin-container">
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <img src="assets/default-logo.jpg" alt="Club Logo" class="admin-logo" id="sidebarLogo">
                <div class="admin-title" id="sidebarTitle">Admin Panel</div>
                <div class="admin-subtitle" id="sidebarSubtitle">Loading...</div>
            </div>
            
            <nav class="sidebar-nav">
                <a class="nav-item active" data-section="dashboard">
                    <span class="nav-item-icon">üìä</span>
                    Dashboard
                </a>
                <a class="nav-item" data-section="club-config">
                    <span class="nav-item-icon">‚öôÔ∏è</span>
                    Club Config
                </a>
                <a class="nav-item" data-section="members">
                    <span class="nav-item-icon">üë•</span>
                    Members
                </a>
                <a class="nav-item" data-section="events">
                    <span class="nav-item-icon">üìÖ</span>
                    Events
                </a>
                <a class="nav-item" data-section="projects">
                    <span class="nav-item-icon">üöÄ</span>
                    Projects
                </a>
                <a class="nav-item" data-section="gallery">
                    <span class="nav-item-icon">üñºÔ∏è</span>
                    Gallery
                </a>
                <a class="nav-item" data-section="announcements">
                    <span class="nav-item-icon">üì¢</span>
                    Announcements
                </a>
                <a class="nav-item" data-section="membership-applications">
                    <span class="nav-item-icon">üìù</span>
                    Membership Applications
                </a>
                <a class="nav-item" data-section="alumni">
                    <span class="nav-item-icon">&#127891;</span>
                    Alumni Management
                </a>
                <a class="nav-item" data-section="admins">
                    <span class="nav-item-icon">üîê</span>
                    Admins
                </a>
                <a class="nav-item" id="superAdminBtn" style="display: none; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; margin-top: var(--space-md); border: 2px solid #f59e0b; font-weight: 700;">
                    <span class="nav-item-icon">üëë</span>
                    Super Admin Panel
                </a>
                <a class="nav-item logout-btn" id="logoutBtn">
                    <span class="nav-item-icon">üö™</span>
                    Logout
                </a>
            </nav>
        </aside>

        <main class="admin-main">
            <div class="admin-header">
                <h1 id="sectionTitle">Dashboard</h1>
                <div class="admin-user">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary);" id="userName">Admin</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);" id="userRole">Super Admin</div>
                    </div>
                </div>
            </div>

            <div class="section-content active" id="dashboardSection">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üë•</div>
                        </div>
                        <div class="stat-number" id="statMembers">0</div>
                        <div class="stat-label">Total Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìÖ</div>
                        </div>
                        <div class="stat-number" id="statEvents">0</div>
                        <div class="stat-label">Total Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üöÄ</div>
                        </div>
                        <div class="stat-number" id="statProjects">0</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üñºÔ∏è</div>
                        </div>
                        <div class="stat-number" id="statGallery">0</div>
                        <div class="stat-label">Gallery Photos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìù</div>
                        </div>
                        <div class="stat-number" id="statPendingApplications">0</div>
                        <div class="stat-label">Pending Applications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">&#127891;</div>
                        </div>
                        <div class="stat-number" id="statAlumni">0</div>
                        <div class="stat-label">Alumni</div>
                    </div>
                </div>
                <!-- Admin Permissions Overview -->
                <div class="admin-form" id="adminPermissionsOverview" style="display: none;">
                    <h2 style="margin-bottom: var(--space-lg);">üìã Your Permissions</h2>
                    <div id="permissionsDisplay" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md);"></div>
                </div>
                
                <!-- Other Admins Overview -->
                <div class="admin-form" id="otherAdminsOverview" style="display: none;">
                    <h2 style="margin-bottom: var(--space-lg);">üë• Other Administrators</h2>
                    <div id="otherAdminsDisplay"></div>
                </div>
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Quick Overview</h2>
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-md);">
                        Welcome to the GSTU Robotics & Research Club Admin Panel. Use the sidebar navigation to manage different sections of the website.
                    </p>
                    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="navigateToSection('members')">Manage Members</button>
                        <button class="btn btn-secondary" onclick="navigateToSection('events')">Manage Events</button>
                        <button class="btn btn-outline" onclick="navigateToSection('projects')">Manage Projects</button>
                    </div>
                </div>
            </div>

            <div class="section-content" id="clubConfigSection">
                <form class="admin-form" id="clubConfigForm">
                    <h2 style="margin-bottom: var(--space-lg);">Club Configuration</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Club Logo</label>
                        <div class="file-input-wrapper">
                            <label for="logoInput" class="file-input-label">üì∑ Choose Logo Image</label>
                            <input type="file" id="logoInput" accept="image/*">
                        </div>
                        <input type="url" class="form-input" id="logoUrl" placeholder="Or enter image URL" style="margin-top: var(--space-sm);">
                        <img id="logoPreview" class="image-preview" style="display: none;">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Club Name</label>
                        <input type="text" class="form-input" id="clubName" placeholder="GSTU Robotics & Research Club" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Club Motto</label>
                        <input type="text" class="form-input" id="clubMotto" placeholder="A Hub of Robothinkers" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Club Description</label>
                        <textarea class="form-textarea" id="clubDescription" placeholder="Enter club description..." required></textarea>
                    </div>

                    <h3 style="margin: var(--space-xl) 0 var(--space-md);">Social Links</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Facebook</label>
                            <input type="url" class="form-input" id="socialFacebook" placeholder="https://facebook.com/...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Twitter</label>
                            <input type="url" class="form-input" id="socialTwitter" placeholder="https://twitter.com/...">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Instagram</label>
                            <input type="url" class="form-input" id="socialInstagram" placeholder="https://instagram.com/...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">LinkedIn</label>
                            <input type="url" class="form-input" id="socialLinkedin" placeholder="https://linkedin.com/...">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">YouTube</label>
                            <input type="url" class="form-input" id="socialYoutube" placeholder="https://youtube.com/...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">GitHub</label>
                            <input type="url" class="form-input" id="socialGithub" placeholder="https://github.com/...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="socialEmail" placeholder="contact@grrc.edu.bd">
                    </div>

                    <h3 style="margin: var(--space-xl) 0 var(--space-md);">Membership Settings</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">bKash Number</label>
                            <input type="text" class="form-input" id="bkashNumber" placeholder="01712345678" pattern="^(\+8801|01)[3-9]\d{8}$" required>
                            <div class="form-help" style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">üì± Enter bKash number for membership payments</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Membership Fee (‡ß≥)</label>
                            <input type="number" class="form-input" id="membershipFee" placeholder="500" min="0" required>
                            <div class="form-help" style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">üí∞ Set membership fee amount</div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">üíæ Save Configuration</button>
                </form>
            </div>

            <div class="section-content" id="membersSection">
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Add/Edit Member</h2>
                    <form id="memberForm">
                        <input type="hidden" id="memberId">
                        
                        <div class="form-group">
                            <label class="form-label">Photo</label>
                            <div class="file-input-wrapper">
                                <label for="memberPhoto" class="file-input-label">üì∑ Choose Photo</label>
                                <input type="file" id="memberPhoto" accept="image/*">
                            </div>
                            <input type="url" class="form-input" id="memberPhotoUrl" placeholder="Or enter image URL" style="margin-top: var(--space-sm);">
                            <img id="memberPhotoPreview" class="image-preview" style="display: none;">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-input" id="memberName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-input" id="memberEmail" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Department *</label>
                                <select class="form-select" id="memberDepartment" required>
                                    <option value="">Select Department</option>
                                    <optgroup label="Faculty of Engineering">
                                        <option value="Computer Science and Engineering (CSE)">Computer Science and Engineering (CSE)</option>
                                        <option value="Electrical and Electronic Engineering (EEE)">Electrical and Electronic Engineering (EEE)</option>
                                        <option value="Electronics and Telecommunication Engineering (ETE)">Electronics and Telecommunication Engineering (ETE)</option>
                                        <option value="Applied Chemistry and Chemical Engineering (ACCE)">Applied Chemistry and Chemical Engineering (ACCE)</option>
                                        <option value="Civil Engineering (CE)">Civil Engineering (CE)</option>
                                        <option value="Food and Agroprocess Engineering (FAE)">Food and Agroprocess Engineering (FAE)</option>
                                        <option value="Architecture (ARCH)">Architecture (ARCH)</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Science">
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Statistics">Statistics</option>
                                        <option value="Chemistry">Chemistry</option>
                                        <option value="Physics">Physics</option>
                                        <option value="Environmental Science & Disaster Management (ESDM)">Environmental Science & Disaster Management (ESDM)</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Life Science">
                                        <option value="Pharmacy">Pharmacy</option>
                                        <option value="Biotechnology and Genetic Engineering (BGE)">Biotechnology and Genetic Engineering (BGE)</option>
                                        <option value="Biochemistry and Molecular Biology (BMB)">Biochemistry and Molecular Biology (BMB)</option>
                                        <option value="Psychology">Psychology</option>
                                        <option value="Botany">Botany</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Humanities (Arts)">
                                        <option value="English">English</option>
                                        <option value="Bangla">Bangla</option>
                                        <option value="History">History</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Social Science">
                                        <option value="Sociology">Sociology</option>
                                        <option value="Public Administration (PAD)">Public Administration (PAD)</option>
                                        <option value="International Relations (IR)">International Relations (IR)</option>
                                        <option value="Economics">Economics</option>
                                        <option value="Political Science">Political Science</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Business Studies">
                                        <option value="Management Studies">Management Studies</option>
                                        <option value="Accounting and Information Systems (AIS)">Accounting and Information Systems (AIS)</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Finance and Banking">Finance and Banking</option>
                                        <option value="Tourism and Hospitality Management (THM)">Tourism and Hospitality Management (THM)</option>
                                    </optgroup>
                                    <optgroup label="Faculty of Law">
                                        <option value="Law">Law</option>
                                    </optgroup>
                                    <optgroup label="Sheikh Hasina Agriculture Institute">
                                        <option value="Agriculture">Agriculture</option>
                                        <option value="Fisheries and Marine Bioscience (FMB)">Fisheries and Marine Bioscience (FMB)</option>
                                        <option value="Livestock Science and Veterinary Medicine (LSVM)">Livestock Science and Veterinary Medicine (LSVM)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year *</label>
                                <select class="form-select" id="memberYear" required>
                                    <option value="">Select Year</option>
                                    <option value="1st">1st Year</option>
                                    <option value="2nd">2nd Year</option>
                                    <option value="3rd">3rd Year</option>
                                    <option value="4th">4th Year</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Role *</label>
                                <select class="form-select" id="memberRole" required>
                                    <option value="">Select Role</option>
                                    <option value="Executive Member">Executive Member</option>
                                    <option value="General Member">General Member</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-input" id="memberPhone" placeholder="+8801234567890">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Bio</label>
                            <textarea class="form-textarea" id="memberBio" placeholder="Brief bio..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Skills (Press Enter after each skill)</label>
                            <div class="tags-container" id="skillsContainer">
                                <input type="text" class="tags-input" id="skillsInput" placeholder="Type a skill and press Enter">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Joined Date</label>
                            <input type="date" class="form-input" id="memberJoinedDate">
                        </div>

                        <div style="display: flex; gap: var(--space-md);">
                            <button type="submit" class="btn btn-primary">üíæ Save Member</button>
                            <button type="button" class="btn btn-secondary" onclick="resetMemberForm()">üîÑ Reset Form</button>
                        </div>
                    </form>
                </div>

                <div class="data-table-wrapper">
                    <div class="table-header">
                        <h3>All Members</h3>
                        <input type="text" class="form-input" id="memberSearch" placeholder="&#128269; Search members..." style="max-width: 300px;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Department</th>
                                    <th>Year</th>
                                    <th>Role</th>
                                    <th>Email</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: var(--space-xl);">No members added yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section-content" id="eventsSection">
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Add/Edit Event</h2>
                    <form id="eventForm">
                        <input type="hidden" id="eventId">
                        
                        <div class="form-group">
                            <label class="form-label">Event Image</label>
                            <div class="file-input-wrapper">
                                <label for="eventImage" class="file-input-label">üì∑ Choose Image</label>
                                <input type="file" id="eventImage" accept="image/*">
                            </div>
                            <input type="url" class="form-input" id="eventImageUrl" placeholder="Or enter image URL" style="margin-top: var(--space-sm);">
                            <img id="eventImagePreview" class="image-preview" style="display: none;">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Event Title *</label>
                                <input type="text" class="form-input" id="eventTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="eventCategory">
                                    <option value="Workshop">Workshop</option>
                                    <option value="Competition">Competition</option>
                                    <option value="Seminar">Seminar</option>
                                    <option value="Meetup">Meetup</option>
                                    <option value="General">General</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description *</label>
                            <textarea class="form-textarea" id="eventDescription" required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Date *</label>
                                <input type="date" class="form-input" id="eventDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time *</label>
                                <input type="text" class="form-input" id="eventTime" placeholder="2:00 PM - 5:00 PM" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Venue *</label>
                                <input type="text" class="form-input" id="eventVenue" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="eventStatus">
                                    <option value="upcoming">Upcoming</option>
                                    <option value="ongoing">Ongoing</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Registration Link</label>
                            <input type="url" class="form-input" id="eventRegistrationLink" placeholder="https://forms.google.com/...">
                        </div>

                        <div style="display: flex; gap: var(--space-md);">
                            <button type="submit" class="btn btn-primary">üíæ Save Event</button>
                            <button type="button" class="btn btn-secondary" onclick="resetEventForm()">üîÑ Reset Form</button>
                        </div>
                    </form>
                </div>

                <div class="data-table-wrapper">
                    <div class="table-header">
                        <h3>All Events</h3>
                        <input type="text" class="form-input" id="eventSearch" placeholder="&#128269; Search events..." style="max-width: 300px;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date</th>
                                    <th>Venue</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: var(--space-xl);">No events added yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section-content" id="projectsSection">
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Add/Edit Project</h2>
                    <form id="projectForm">
                        <input type="hidden" id="projectId">
                        
                        <div class="form-group">
                            <label class="form-label">Project Image</label>
                            <div class="file-input-wrapper">
                                <label for="projectImage" class="file-input-label">üì∑ Choose Image</label>
                                <input type="file" id="projectImage" accept="image/*">
                            </div>
                            <input type="url" class="form-input" id="projectImageUrl" placeholder="Or enter image URL" style="margin-top: var(--space-sm);">
                            <img id="projectImagePreview" class="image-preview" style="display: none;">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Project Title *</label>
                                <input type="text" class="form-input" id="projectTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="projectCategory">
                                    <option value="Robotics">Robotics</option>
                                    <option value="IoT">IoT</option>
                                    <option value="AI/ML">AI/ML</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Mobile App">Mobile App</option>
                                    <option value="Research">Research</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description *</label>
                            <textarea class="form-textarea" id="projectDescription" required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="projectStatus">
                                    <option value="completed">Completed</option>
                                    <option value="ongoing">Ongoing</option>
                                    <option value="planned">Planned</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Completion Date</label>
                                <input type="date" class="form-input" id="projectCompletionDate">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Technologies (Press Enter after each)</label>
                            <div class="tags-container" id="technologiesContainer">
                                <input type="text" class="tags-input" id="technologiesInput" placeholder="Type a technology and press Enter">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Team Members (One per line)</label>
                            <textarea class="form-textarea" id="projectTeamMembers" placeholder="John Doe - Lead Developer&#10;Jane Smith - Designer" style="min-height: 80px;"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">GitHub Link</label>
                                <input type="url" class="form-input" id="projectGithubLink" placeholder="https://github.com/...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Live Demo Link</label>
                                <input type="url" class="form-input" id="projectLiveLink" placeholder="https://demo.example.com">
                            </div>
                        </div>

                        <div style="display: flex; gap: var(--space-md);">
                            <button type="submit" class="btn btn-primary">üíæ Save Project</button>
                            <button type="button" class="btn btn-secondary" onclick="resetProjectForm()">üîÑ Reset Form</button>
                        </div>
                    </form>
                </div>

                <div class="data-table-wrapper">
                    <div class="table-header">
                        <h3>All Projects</h3>
                        <input type="text" class="form-input" id="projectSearch" placeholder="&#128269; Search projects..." style="max-width: 300px;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Technologies</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: var(--space-xl);">No projects added yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section-content" id="gallerySection">
    <div class="admin-form">
        <h2 style="margin-bottom: var(--space-lg);">Add Gallery Item</h2>
        
        <div style="background: var(--background-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">
                üí° Images are automatically optimized and stored securely in the cloud for best performance.
            </p>
        </div>
        
        <form id="galleryForm">
            <input type="hidden" id="galleryId">
            <input type="hidden" id="galleryCloudinaryUrl">
            
            <div class="form-group">
                    <label class="form-label">Image * (Recommended: 1920x1080px or higher)</label>
                    <div class="file-input-wrapper">
                        <label for="galleryImage" class="file-input-label">üì∑ Select Image</label>
                        <input type="file" id="galleryImage" accept="image/*">
                    </div>
                
                <!-- Upload Progress -->
                <div id="uploadProgress" style="display: none; margin-top: 1rem;">
                    <div style="background: #f3f4f6; border-radius: 8px; height: 8px; overflow: hidden;">
                        <div id="uploadProgressBar" style="background: linear-gradient(90deg, #6366f1, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <p id="uploadStatus" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);"></p>
                </div>
                
                <img id="galleryImagePreview" class="image-preview" style="display: none; margin-top: 1rem;">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-input" id="galleryTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-select" id="galleryCategory" required>
                        <option value="Events">Events</option>
                        <option value="Workshops">Workshops</option>
                        <option value="Projects">Projects</option>
                        <option value="Team">Team</option>
                        <option value="Competitions">Competitions</option>
                        <option value="General">General</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="galleryDescription" style="min-height: 80px;"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Date *</label>
                    <input type="date" class="form-input" id="galleryDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Photographer</label>
                    <input type="text" class="form-input" id="galleryPhotographer" placeholder="Optional">
                </div>
            </div>

            <div style="display: flex; gap: var(--space-md);">
                <button type="submit" class="btn btn-primary" id="gallerySubmitBtn">üíæ Add to Gallery</button>
                <button type="button" class="btn btn-secondary" onclick="resetGalleryForm()">üîÑ Reset Form</button>
            </div>
        </form>
    </div>

    <div class="data-table-wrapper">
        <div class="table-header">
            <h3>Gallery Items</h3>
            <input type="text" class="form-input" id="gallerySearch" placeholder="üîç Search gallery..." style="max-width: 300px;">
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Preview</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="galleryTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: var(--space-xl);">No gallery items yet</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

            <div class="section-content" id="announcementsSection">
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Add/Edit Announcement</h2>
                    <form id="announcementForm">
                        <input type="hidden" id="announcementId">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Title *</label>
                                <input type="text" class="form-input" id="announcementTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority</label>
                                <select class="form-select" id="announcementPriority">
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Content *</label>
                            <textarea class="form-textarea" id="announcementContent" required style="min-height: 150px;"></textarea>
                        </div>

                        <div style="display: flex; gap: var(--space-md);">
                            <button type="submit" class="btn btn-primary">üíæ Save Announcement</button>
                            <button type="button" class="btn btn-secondary" onclick="resetAnnouncementForm()">üîÑ Reset Form</button>
                        </div>
                    </form>
                </div>

                <div class="data-table-wrapper">
                    <div class="table-header">
                        <h3>All Announcements</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Priority</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="announcementsTableBody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: var(--space-xl);">No announcements yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section-content" id="adminsSection">
                <div class="admin-form">
                    <h2 style="margin-bottom: var(--space-lg);">Add New Admin</h2>
                    <form id="adminForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Username *</label>
                                <input type="text" class="form-input" id="adminUsername" required minlength="3">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Role</label>
                                <input type="text" class="form-input" id="adminRole" value="Admin" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password * (minimum 6 characters)</label>
                            <input type="password" class="form-input" id="adminPassword" required minlength="6">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Confirm Password *</label>
                            <input type="password" class="form-input" id="adminPasswordConfirm" required minlength="6">
                        </div>

                        <button type="submit" class="btn btn-primary">‚ûï Add Admin</button>
                    </form>
                </div>

                <div class="data-table-wrapper">
                    <div class="table-header">
                        <h3>All Admins</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Created At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: var(--space-xl);">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Membership Applications Section -->
            <div class="section-content" id="membershipApplicationsSection">
               <iframe src="admin-membership.html" 
        style="width: 100%; height: calc(100vh - 200px); border: none; display: block;" 
        id="membershipIframe"
        onload="
            const iframe = this;
            setTimeout(() => {
                const token = window.apiClient?.getAuthToken();
                if (token && iframe.contentWindow.apiClient) {
                    iframe.contentWindow.apiClient.setAuthToken(token);
                }
                iframe.contentWindow.loadApplicationStatistics?.();
                iframe.contentWindow.loadMembershipApplications?.('pending');
            }, 500);
        "></iframe>
            </div>

            <!-- Alumni Management Section (Iframe) -->
            <div class="section-content" id="alumniSection">
                <iframe src="admin-alumni.html" 
                        style="width: 100%; height: calc(100vh - 200px); border: none; display: block;" 
                        id="alumniIframe"></iframe>
            </div>
        </main>

        <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">‚ò∞</button>
    </div>

    <!-- Super Admin Verification Modal -->
    <div id="superAdminModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000;">
        <div class="modal-content" style="background: var(--surface-color); border-radius: var(--radius-lg); padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-xl); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0; color: var(--text-primary);">üëë Super Admin Verification</h2>
                <button onclick="closeSuperAdminModal()" style="background: transparent; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">&times;</button>
            </div>
            
            <div style="background: rgba(245, 158, 11, 0.1); border: 2px solid #f59e0b; border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1.5rem;">
                <p style="margin: 0; color: var(--text-primary); font-size: 0.9rem;">
                    üîí Enter your password to access the Super Admin Panel. This grants full system control.
                </p>
            </div>
            
            <form id="superAdminVerificationForm">
                <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label class="form-label" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                        <input type="password" id="superAdminPassword" class="form-input" placeholder="Enter your password" required autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 1rem;">
                    </div>
                
                <div id="superAdminError" style="display: none; background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 0.75rem; border-radius: var(--radius-md); margin-bottom: 1rem; font-size: 0.9rem;"></div>
                
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; border-radius: var(--radius-md); color: white; font-weight: 600; cursor: pointer;">
                        ‚úì Verify & Access
                    </button>
                    <button type="button" onclick="closeSuperAdminModal()" class="btn btn-secondary" style="flex: 1; padding: 0.75rem; background: var(--surface-color); border: 2px solid var(--border-color); border-radius: var(--radius-md); color: var(--text-primary); font-weight: 600; cursor: pointer;">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/api-client.js"></script>
    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/load-config.js"></script>

    <script>
        if (!isAuthenticated()) {
            window.location.href = 'admin.html';
        }

        let currentSection = 'dashboard';
        let memberSkills = [];
        let projectTechnologies = [];
        let currentEditMemberId = null;
        let currentEditEventId = null;
        let currentEditProjectId = null;
        let currentEditAnnouncementId = null;

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Admin Panel Loading...');
            
            async function initializeAdminPanel() {
                // CRITICAL: Check token FIRST, create session if missing
                
                const token = localStorage.getItem('grrc_auth_token');
                let session = sessionStorage.getItem('adminSession');
                
                console.log('Auth Check - Token:', token ? 'EXISTS' : 'MISSING', 'Session:', session ? 'EXISTS' : 'MISSING');
                
                // If token exists but session missing, recreate session
                if (token && !session) {
                    console.warn('Token exists but session missing - recreating session');
                    try {
                        const tokenData = JSON.parse(atob(token.split('.')[1]));
                        console.log('üîç Token payload:', tokenData);
                        
                        const newSession = {
                            username: tokenData.username || 'admin',
                            role: tokenData.role || 'Admin',
                            adminId: tokenData.id || tokenData.adminId,
                            timestamp: new Date().toISOString(),
                            hasToken: true,
                            is_super_admin: tokenData.is_super_admin || false,
                            permissions: tokenData.permissions || {}
                        };
                        
                        sessionStorage.setItem('adminSession', JSON.stringify(newSession));
                        session = sessionStorage.getItem('adminSession');
                        console.log('‚úÖ Session recreated with is_super_admin:', newSession.is_super_admin);
                    } catch (error) {
                        console.error('Failed to recreate session:', error);
                    }
                }
                
                if (!session || !token) {
                    console.error('Not authenticated - redirecting to login');
                    alert('Please log in to access the admin panel');
                    window.location.href = 'admin.html';
                    return;
                }

                // CRITICAL FIX: Wait for BOTH apiClient AND ensure token is set
                if (!window.apiClient || !window.apiClient.isReady) {
                    console.warn('API client not ready yet, retrying...');
                    setTimeout(initializeAdminPanel, 100);
                    return;
                }

                // CRITICAL FIX: ALWAYS set token from localStorage
                console.log('üîê Force-loading token into API client from localStorage...');
                window.apiClient.setAuthToken(token);
                
                // Verify it stuck
                const apiToken = window.apiClient.getAuthToken();
                console.log('API Token after force-load:', apiToken ? 'LOADED ‚úÖ' : 'MISSING ‚ùå');
                
                if (!apiToken) {
                    console.error('‚ùå CRITICAL: Failed to load token into API client!');
                    alert('Authentication error. Please log in again.');
                    sessionStorage.clear();
                    localStorage.removeItem('grrc_auth_token');
                    window.location.href = 'admin.html';
                    return;
                }

                console.log('‚úÖ All authentication checks passed!');

                initTheme();
                loadAdminInfo();
                await loadClubConfigToSidebar();
                await loadDashboardStats();
                await loadAdminDashboardInfo(); // ‚úÖ FIX: Load dashboard info on initial load
                setupNavigation();
                setupLogoutButton();
                setupForms();
                setupMobileSidebar();
                await loadAllData();
                
                // ‚úÖ FIX: Load club config data immediately after initialization
                if (currentSection === 'club-config') {
                    await loadClubConfig();
                }
            }

            // CRITICAL FIX: Wait longer for all scripts to load
            setTimeout(initializeAdminPanel, 500);
        });

        function loadAdminInfo() {
            const admin = getCurrentAdmin();
            console.log('üë§ Loading admin info:', admin);
            
            if (admin) {
                document.getElementById('userName').textContent = admin.username;
                document.getElementById('userRole').textContent = admin.role || 'Admin';
                document.getElementById('userAvatar').textContent = admin.username.charAt(0).toUpperCase();
                
                // Show Super Admin button - check multiple conditions
                const isSuperAdmin = admin.is_super_admin === true || 
                                    admin.is_super_admin === 1 ||
                                    admin.role === 'Super Admin';
                
                console.log('üîç Super Admin check:', {
                    is_super_admin: admin.is_super_admin,
                    role: admin.role,
                    isSuperAdmin: isSuperAdmin
                });
                
                if (isSuperAdmin) {
                    const superAdminBtn = document.getElementById('superAdminBtn');
                    if (superAdminBtn) {
                        superAdminBtn.style.display = 'flex';
                        console.log('‚úÖ Super Admin button shown');
                    } else {
                        console.error('‚ùå Super Admin button element not found!');
                    }
                } else {
                    console.log('‚ÑπÔ∏è Not a super admin - button hidden');
                }
            }
        }

       async function loadClubConfigToSidebar() {
    try {
        console.log('üìÑ Loading sidebar config...');
        
        // ‚úÖ CRITICAL: Clear cache FIRST to force fresh API fetch
        localStorage.removeItem('cache_clubConfig');
        localStorage.removeItem('clubConfig');
        
        const result = await getClubConfig();
        if (result.success && result.data) {
            const config = result.data;
            const logo = document.getElementById('sidebarLogo');
            const subtitle = document.querySelector('.admin-subtitle');
            
            console.log('üì¶ Fresh config loaded:', config);
            
            if (logo && (config.logo || config.logo_url)) {
    const logoUrl = config.logo || config.logo_url;
    
    // ‚úÖ FIX: Don't add cache-busting to base64 data URLs
    let cacheBustedUrl;
    if (logoUrl.startsWith('data:')) {
        // Base64 data URL - use as-is
        cacheBustedUrl = logoUrl;
    } else {
        // Regular URL - add cache-busting timestamp
        cacheBustedUrl = logoUrl.includes('?') 
            ? logoUrl + '&t=' + Date.now()
            : logoUrl + '?t=' + Date.now();
    }
        
    logo.src = cacheBustedUrl;
    logo.onerror = function() {
        console.warn('Logo failed to load, using default');
        this.src = 'assets/default-logo.jpg';
    };
    console.log('‚úÖ Logo updated to:', cacheBustedUrl.startsWith('data:') ? 'base64 image' : cacheBustedUrl);
}
            
            if (subtitle) {
                const nameValue = config.name || config.club_name;
                if (nameValue) {
                    subtitle.textContent = nameValue;
                    console.log('‚úÖ Name updated to:', nameValue);
                }
            }
            return;
        }

        // Fallback
        console.warn('Using fallback config from localStorage');
        const cachedConfig = localStorage.getItem('clubConfig') || localStorage.getItem('cache_clubConfig');
        const config = cachedConfig ? JSON.parse(cachedConfig) : {};
        const logo = document.getElementById('sidebarLogo');
        const subtitle = document.querySelector('.admin-subtitle');
        
        if (logo && config.logo) {
            const logoUrl = config.logo.includes('?') 
                ? config.logo + '&t=' + Date.now()
                : config.logo + '?t=' + Date.now();
            logo.src = logoUrl;
            logo.onerror = function() {
                this.src = 'assets/default-logo.jpg';
            };
        }
        
        if (subtitle) {
            const nameValue = config.name || config.club_name;
            if (nameValue) {
                subtitle.textContent = nameValue;
            }
        }
    } catch (error) {
        console.error('Error loading sidebar config:', error);
    }
}
async function loadAdminDashboardInfo() {
            const admin = getCurrentAdmin();
            if (!admin) return;
            
            const isSuperAdmin = admin.is_super_admin === true || admin.is_super_admin === 1 || admin.role === 'Super Admin';
            
            console.log('üìä Loading dashboard info for:', admin.username, 'Super Admin:', isSuperAdmin);
            
            // ‚úÖ CRITICAL FIX: Show permissions section for ALL admins
            const permissionsSection = document.getElementById('adminPermissionsOverview');
            const otherAdminsSection = document.getElementById('otherAdminsOverview');
            
            if (permissionsSection) permissionsSection.style.display = 'block';
            if (otherAdminsSection) otherAdminsSection.style.display = 'block';
            
            console.log('‚úÖ Dashboard sections displayed');
            
            if (!isSuperAdmin) {
                console.log('üìã Displaying regular admin permissions');
                
                const permissions = admin.permissions || {};
                const permissionsHTML = Object.keys(permissions).map(module => {
                    const modulePerms = permissions[module];
                    const perms = Object.entries(modulePerms)
                        .filter(([key, val]) => val === true)
                        .map(([key]) => key);
                    
                    if (perms.length === 0) return '';
                    
                    return `
                        <div style="background: var(--background-color); padding: var(--space-md); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                            <h3 style="margin: 0 0 var(--space-sm) 0; color: var(--primary-color); text-transform: capitalize;">${module}</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: var(--space-xs);">
                                ${perms.map(p => `<span class="badge badge-success">${p}</span>`).join('')}
                            </div>
                        </div>
                    `;
                }).filter(Boolean).join('');
                
                document.getElementById('permissionsDisplay').innerHTML = permissionsHTML || '<p style="color: var(--text-secondary);">No permissions assigned yet. Contact your Super Admin.</p>';
                
                try {
                    const result = await window.apiClient.getAdmins();
                    if (result.success && result.data) {
                        const otherAdmins = result.data.filter(a => a.id !== admin.id && a.is_super_admin !== true);
                        
                        const adminsHTML = otherAdmins.map(a => {
                            const perms = a.permissions || {};
                            const modules = Object.keys(perms).filter(m => Object.values(perms[m]).some(v => v === true));
                            
                            return `
                                <div style="background: var(--background-color); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-sm);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong style="color: var(--text-primary);">${a.username}</strong>
                                            <span class="badge badge-info" style="margin-left: var(--space-xs);">${a.role || 'Admin'}</span>
                                        </div>
                                        <span class="badge ${a.is_active ? 'badge-success' : 'badge-error'}">${a.is_active ? 'Active' : 'Inactive'}</span>
                                    </div>
                                    <div style="margin-top: var(--space-xs); font-size: 0.875rem; color: var(--text-secondary);">
                                        Can manage: ${modules.join(', ') || 'No permissions'}
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('otherAdminsDisplay').innerHTML = adminsHTML || '<p style="color: var(--text-secondary);">No other administrators.</p>';
                    }
                } catch (error) {
                    console.error('Error loading other admins:', error);
                }
            } else {
                // Super Admin view - show ALL admins
                const perms = admin.permissions || {};
                const permissionsHTML = `
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: var(--space-md); border-radius: var(--radius-md); color: white;">
                        <h3 style="margin: 0 0 var(--space-sm) 0;">üëë Super Admin</h3>
                        <p style="margin: 0; font-size: 0.9rem;">You have full system access and control over all features.</p>
                    </div>
                `;
                document.getElementById('permissionsDisplay').innerHTML = permissionsHTML;
                
                // ‚úÖ Show ALL admins for Super Admin view
                console.log('üëë Loading all admins for Super Admin');
                try {
                    const result = await window.apiClient.getAdmins();
                    if (result.success && result.data) {
                        const allAdmins = result.data;
                        
                        const adminsHTML = allAdmins.map(a => {
                            const perms = a.permissions || {};
                            const modules = Object.keys(perms).filter(m => Object.values(perms[m]).some(v => v === true));
                            const isSelf = a.id === admin.id;
                            const isSuperAdminAccount = a.is_super_admin === true || a.role === 'Super Admin';
                            
                            return `
                                <div style="background: var(--background-color); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-sm); ${isSelf ? 'border: 2px solid var(--primary-color);' : ''}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong style="color: var(--text-primary);">${a.username}</strong>
                                            ${isSelf ? '<span class="badge" style="background: var(--primary-color); color: white; margin-left: 0.5rem;">You</span>' : ''}
                                            ${isSuperAdminAccount ? '<span class="badge" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; margin-left: 0.5rem;">üëë Super Admin</span>' : `<span class="badge badge-info" style="margin-left: var(--space-xs);">${a.role || 'Admin'}</span>`}
                                        </div>
                                        <span class="badge ${a.is_active ? 'badge-success' : 'badge-error'}">${a.is_active ? 'Active' : 'Inactive'}</span>
                                    </div>
                                    <div style="margin-top: var(--space-xs); font-size: 0.875rem; color: var(--text-secondary);">
                                        ${isSuperAdminAccount ? 'Full system access' : `Can manage: ${modules.join(', ') || 'No permissions'}`}
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('otherAdminsDisplay').innerHTML = adminsHTML || '<p style="color: var(--text-secondary);">No other administrators.</p>';
                    }
                } catch (error) {
                    console.error('Error loading admins list:', error);
                }
            }
        }
        async function loadDashboardStats() {
            try {
                console.log('üìä Loading dashboard statistics...');
                
                // Check if we have recent stats in sessionStorage (faster than API calls)
                const cachedStats = sessionStorage.getItem('dashboard_stats');
                const cacheTime = sessionStorage.getItem('dashboard_stats_time');
                const now = Date.now();
                const STATS_CACHE_DURATION = 30 * 1000; // 30 seconds
                
                if (cachedStats && cacheTime && (now - parseInt(cacheTime)) < STATS_CACHE_DURATION) {
                    const stats = JSON.parse(cachedStats);
                    Object.entries(stats).forEach(([id, value]) => {
                        const element = document.getElementById(id);
                        if (element) element.textContent = value;
                    });
                    console.log('‚úÖ Dashboard stats loaded from cache');
                    return;
                }
                
                // Add cache-busting timestamp to force fresh API calls
                const timestamp = Date.now();
                
                // Fetch fresh data from APIs with cache-busting
                const [membersResult, eventsResult, projectsResult, galleryResult, applicationsResult, alumniResult] = await Promise.all([
                    fetch(`${window.apiClient.baseURL}/api/content/members?_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json()),
                    fetch(`${window.apiClient.baseURL}/api/content/events?_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json()),
                    fetch(`${window.apiClient.baseURL}/api/content/projects?_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json()),
                    fetch(`${window.apiClient.baseURL}/api/content/gallery?_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json()),
                    fetch(`${window.apiClient.baseURL}/api/membership/applications?status=pending&_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json()),
                    fetch(`${window.apiClient.baseURL}/api/alumni?_t=${timestamp}`, {
                        headers: { 'Authorization': `Bearer ${window.apiClient.getAuthToken()}` }
                    }).then(r => r.json())
                ]);
                
                // Update statistics
                const membersCount = (membersResult.success && Array.isArray(membersResult.data)) ? membersResult.data.length : 0;
                const eventsCount = (eventsResult.success && Array.isArray(eventsResult.data)) ? eventsResult.data.length : 0;
                const projectsCount = (projectsResult.success && Array.isArray(projectsResult.data)) ? projectsResult.data.length : 0;
                const galleryCount = (galleryResult.success && Array.isArray(galleryResult.data)) ? galleryResult.data.length : 0;
                const pendingCount = (applicationsResult.success && Array.isArray(applicationsResult.data)) ? applicationsResult.data.length : 0;
                const alumniCount = (alumniResult.success && Array.isArray(alumniResult.data)) ? alumniResult.data.length : 0;
                
                // Force DOM update
                const statElements = {
                    'statMembers': membersCount,
                    'statEvents': eventsCount,
                    'statProjects': projectsCount,
                    'statGallery': galleryCount,
                    'statPendingApplications': pendingCount,
                    'statAlumni': alumniCount
                };
                
                Object.entries(statElements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                        // Force browser repaint
                        element.style.display = 'none';
                        element.offsetHeight; // Trigger reflow
                        element.style.display = '';
                    }
                });
                
                // Store in sessionStorage for quick reload
                sessionStorage.setItem('dashboard_stats', JSON.stringify(statElements));
                sessionStorage.setItem('dashboard_stats_time', Date.now().toString());
                
                console.log('‚úÖ Dashboard stats updated:', statElements);
            } catch (error) {
                console.error('‚ùå Error loading dashboard stats:', error);
                ['statMembers', 'statEvents', 'statProjects', 'statGallery', 'statPendingApplications', 'statAlumni'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = '0';
                });
            }
        }

        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    navigateToSection(section);
                });
            });

            const searchInput = document.getElementById('memberSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    loadMembers(e.target.value);
                });
            }
        }

        async function saveMember() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const name = document.getElementById('memberName').value.trim();
                const email = document.getElementById('memberEmail').value.trim();
                const department = document.getElementById('memberDepartment').value;
                const year = document.getElementById('memberYear').value;
                const role = document.getElementById('memberRole').value;

                console.log('Form values:', { name, email, department, year, role });

                if (!name || !email || !department || !year || !role) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                if (!validateEmail(email)) {
                    showToast('Invalid email format', 'error');
                    return;
                }

                const existingMembers = await window.storage.getMembers();
                const currentEditId = currentEditMemberId;
                
                if (existingMembers.success && existingMembers.data) {
                    const isDuplicate = existingMembers.data.some(m => 
                        m.email.toLowerCase() === email.toLowerCase() && m.id !== currentEditId
                    );
                    
                    if (isDuplicate) {
                        showToast('A member with this email already exists', 'error');
                        return;
                    }
                }

                const phone = document.getElementById('memberPhone').value.trim();
                if (phone && !validatePhone(phone)) {
                    showToast('Invalid phone format (use +880XXXXXXXXXX or 01XXXXXXXXX)', 'error');
                    return;
                }

                const photoFile = document.getElementById('memberPhoto').files[0];
                const photoUrl = document.getElementById('memberPhotoUrl').value.trim();
                let photo = photoUrl;

                if (photoFile) {
                    photo = await imageToBase64(photoFile);
                }

                const memberData = {
                    name: name,
                    photo: photo,
                    department: department,
                    year: year,
                    role: role,
                    email: email,
                    phone: phone,
                    bio: document.getElementById('memberBio').value.trim(),
                    skills: memberSkills,
                    joinedDate: document.getElementById('memberJoinedDate').value
                };

                console.log('Submitting member data:', memberData);

                if (currentEditMemberId) {
                    await window.storage.updateMember(currentEditMemberId, memberData);
                    showToast('Member updated successfully!', 'success');
                } else {
                    await addMember(memberData);
                    showToast('Member added successfully!', 'success');
                }

                localStorage.removeItem('cache_members');
                localStorage.removeItem(STORAGE_KEYS.MEMBERS);

                resetMemberForm();
                await loadMembers();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error saving member:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error saving member', 'error');
                }
            }
        }

        async function loadMembers(searchTerm = '') {
            try {
                localStorage.removeItem('cache_members');
                
                const result = await window.apiClient.getMembers();
                let members = [];

                if (result.success && Array.isArray(result.data)) {
                    members = result.data;
                } else {
                    console.warn('API returned invalid data, using localStorage fallback:', result);
                    members = JSON.parse(localStorage.getItem('members')) || [];
                }
                
                if (searchTerm) {
                    members = members.filter(m => 
                        m.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        m.department.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        m.email.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                const tbody = document.getElementById('membersTableBody');
                
                if (members.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: var(--space-xl);">No members found</td></tr>';
                    return;
                }

                tbody.innerHTML = members.map(member => `
                    <tr>
                        <td style="font-weight: 600;">${member.name}</td>
                        <td>${member.department}</td>
                        <td>${member.year}</td>
                        <td><span class="badge ${member.role === 'Executive Member' ? 'badge-success' : 'badge-info'}">${member.role}</span></td>
                        <td>${member.email}</td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-edit" onclick="editMember('${member.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-icon btn-delete" onclick="deleteMember('${member.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading members:', error);
            }
        }

        async function editMember(id) {
            try {
                const result = await window.apiClient.getMembers();
                const members = result.success ? result.data : [];
                const member = members.find(m => m.id === id);
                
                if (!member) return;

                currentEditMemberId = id;
                
                document.getElementById('memberName').value = member.name || '';
                document.getElementById('memberEmail').value = member.email || '';
                document.getElementById('memberDepartment').value = member.department || '';
                document.getElementById('memberYear').value = member.year || '';
                document.getElementById('memberRole').value = member.role || '';
                document.getElementById('memberPhone').value = member.phone || '';
                document.getElementById('memberBio').value = member.bio || '';
                document.getElementById('memberJoinedDate').value = member.joinedDate || '';

                if (member.photo) {
                    document.getElementById('memberPhotoUrl').value = member.photo;
                    document.getElementById('memberPhotoPreview').src = member.photo;
                    document.getElementById('memberPhotoPreview').style.display = 'block';
                }

                memberSkills = member.skills || [];
                const skillsContainer = document.getElementById('skillsContainer');
                const skillsInput = document.getElementById('skillsInput');
                renderTags(skillsContainer, memberSkills, skillsInput, (index) => {
                    memberSkills.splice(index, 1);
                    renderTags(skillsContainer, memberSkills, skillsInput);
                });

                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('Editing member', 'info');
            } catch (error) {
                console.error('Error editing member:', error);
            }
        }

        async function deleteMember(id) {
            if (!confirm('Are you sure you want to delete this member?')) return;

            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                localStorage.removeItem('cache_members');
                localStorage.removeItem(STORAGE_KEYS.MEMBERS);

                const result = await window.apiClient.deleteMember(id);
                
                if (result.success) {
                    showToast('Member deleted successfully', 'success');
                    await loadMembers();
                    await loadDashboardStats();
                } else {
                    throw new Error(result.error || 'Failed to delete member');
                }
            } catch (error) {
                console.error('Error deleting member:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting member', 'error');
                }
            }
        }

        function resetMemberForm() {
            document.getElementById('memberForm').reset();
            currentEditMemberId = null;
            memberSkills = [];
            document.getElementById('memberPhotoPreview').style.display = 'none';
            const skillsContainer = document.getElementById('skillsContainer');
            const skillsInput = document.getElementById('skillsInput');
            renderTags(skillsContainer, memberSkills, skillsInput, () => {});
        }

        function setupEventForm() {
            const form = document.getElementById('eventForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveEvent();
            });

            const searchInput = document.getElementById('eventSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    loadEvents(e.target.value);
                });
            }
        }

        async function saveEvent() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const title = document.getElementById('eventTitle').value.trim();
                const description = document.getElementById('eventDescription').value.trim();
                const date = document.getElementById('eventDate').value;
                const venue = document.getElementById('eventVenue').value.trim();
                const time = document.getElementById('eventTime').value.trim();

                console.log('Event form values:', { title, description, date, venue, time });

                if (!title || !description || !date || !venue || !time) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                const imageFile = document.getElementById('eventImage').files[0];
                const imageUrl = document.getElementById('eventImageUrl').value.trim();
                let image = imageUrl;

                if (imageFile) {
                    image = await imageToBase64(imageFile);
                }

                const eventData = {
                    title: title,
                    description: description,
                    category: document.getElementById('eventCategory').value,
                    date: date,
                    time: time,
                    venue: venue,
                    image: image,
                    status: document.getElementById('eventStatus').value,
                    registrationLink: document.getElementById('eventRegistrationLink').value.trim()
                };

                console.log('Submitting event data:', eventData);

                if (currentEditEventId) {
                    await window.storage.updateEvent(currentEditEventId, eventData);
                    showToast('Event updated successfully!', 'success');
                } else {
                    await addEvent(eventData);
                    showToast('Event added successfully!', 'success');
                }

                localStorage.removeItem('cache_events');
                localStorage.removeItem(STORAGE_KEYS.EVENTS);

                resetEventForm();
                await loadEvents();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error saving event:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error saving event', 'error');
                }
            }
        }

        async function loadEvents(searchTerm = '') {
            try {
                localStorage.removeItem('cache_events');
                
                const result = await window.apiClient.getEvents();
                let events = [];

                if (result.success && Array.isArray(result.data)) {
                    events = result.data;
                } else {
                    console.warn('API returned invalid data, using localStorage fallback:', result);
                    events = JSON.parse(localStorage.getItem('events')) || [];
                }
                
                if (searchTerm) {
                    events = events.filter(e => 
                        e.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        e.venue.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                const tbody = document.getElementById('eventsTableBody');
                
                if (events.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: var(--space-xl);">No events found</td></tr>';
                    return;
                }

                tbody.innerHTML = events.map(event => `
                    <tr>
                        <td style="font-weight: 600;">${event.title}</td>
                        <td>${formatDate(event.date)}</td>
                        <td>${event.venue}</td>
                        <td><span class="badge ${getStatusBadgeClass(event.status)}">${event.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-edit" onclick="editEvent('${event.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-icon btn-delete" onclick="deleteEvent('${event.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }

        async function editEvent(id) {
            try {
                const result = await window.apiClient.getEvents();
                const events = result.success ? result.data : [];
                const event = events.find(e => e.id === id);
                
                if (!event) return;

                currentEditEventId = id;
                
                document.getElementById('eventTitle').value = event.title || '';
                document.getElementById('eventDescription').value = event.description || '';
                document.getElementById('eventCategory').value = event.category || 'Workshop';
                document.getElementById('eventDate').value = event.date || '';
                document.getElementById('eventTime').value = event.time || '';
                document.getElementById('eventVenue').value = event.venue || '';
                document.getElementById('eventStatus').value = event.status || 'upcoming';
                document.getElementById('eventRegistrationLink').value = event.registrationLink || '';

                if (event.image) {
                    document.getElementById('eventImageUrl').value = event.image;
                    document.getElementById('eventImagePreview').src = event.image;
                    document.getElementById('eventImagePreview').style.display = 'block';
                }

                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('Editing event', 'info');
            } catch (error) {
                console.error('Error editing event:', error);
            }
        }

        async function deleteEvent(id) {
            if (!confirm('Are you sure you want to delete this event?')) return;

            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                localStorage.removeItem('cache_events');
                localStorage.removeItem(STORAGE_KEYS.EVENTS);

                await window.storage.deleteEvent(id);
                showToast('Event deleted successfully', 'success');
                await loadEvents();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error deleting event:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting event', 'error');
                }
            }
        }

        function resetEventForm() {
            document.getElementById('eventForm').reset();
            currentEditEventId = null;
            document.getElementById('eventImagePreview').style.display = 'none';
        }

        function setupProjectForm() {
            const form = document.getElementById('projectForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveProject();
            });

            const searchInput = document.getElementById('projectSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    loadProjects(e.target.value);
                });
            }
        }

        async function saveProject() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const title = document.getElementById('projectTitle').value.trim();
                const description = document.getElementById('projectDescription').value.trim();
                const category = document.getElementById('projectCategory').value;

                console.log('Project form values:', { title, description, category });

                if (!title || !description || !category) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                const imageFile = document.getElementById('projectImage').files[0];
                const imageUrl = document.getElementById('projectImageUrl').value.trim();
                let image = imageUrl;

                if (imageFile) {
                    image = await imageToBase64(imageFile);
                }

                const teamMembersText = document.getElementById('projectTeamMembers').value;
                const teamMembers = teamMembersText.split('\n').filter(m => m.trim()).map(m => m.trim());

                const projectData = {
                    title: title,
                    description: description,
                    category: category,
                    status: document.getElementById('projectStatus').value,
                    image: image,
                    technologies: projectTechnologies,
                    teamMembers: teamMembers,
                    githubLink: document.getElementById('projectGithubLink').value.trim(),
                    liveLink: document.getElementById('projectLiveLink').value.trim(),
                    completionDate: document.getElementById('projectCompletionDate').value
                };

                console.log('Submitting project data:', projectData);

                if (currentEditProjectId) {
                    await window.storage.updateProject(currentEditProjectId, projectData);
                    showToast('Project updated successfully!', 'success');
                } else {
                    await addProject(projectData);
                    showToast('Project added successfully!', 'success');
                }

                localStorage.removeItem('cache_projects');
                localStorage.removeItem(STORAGE_KEYS.PROJECTS);

                resetProjectForm();
                await loadProjects();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error saving project:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error saving project', 'error');
                }
            }
        }

        async function loadProjects(searchTerm = '') {
            try {
                localStorage.removeItem('cache_projects');
                
                const result = await window.apiClient.getProjects();
                let projects = [];

                if (result.success && Array.isArray(result.data)) {
                    projects = result.data;
                } else {
                    console.warn('API returned invalid data, using localStorage fallback:', result);
                    projects = JSON.parse(localStorage.getItem('projects')) || [];
                }
                
                if (searchTerm) {
                    projects = projects.filter(p => 
                        p.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        p.description.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                const tbody = document.getElementById('projectsTableBody');
                
                if (projects.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: var(--space-xl);">No projects found</td></tr>';
                    return;
                }

                tbody.innerHTML = projects.map(project => `
                    <tr>
                        <td style="font-weight: 600;">${project.title}</td>
                        <td>${project.category}</td>
                        <td><span class="badge ${getStatusBadgeClass(project.status)}">${project.status}</span></td>
                        <td>${Array.isArray(project.technologies) ? project.technologies.slice(0, 3).join(', ') : ''}${Array.isArray(project.technologies) && project.technologies.length > 3 ? '...' : ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-edit" onclick="editProject('${project.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-icon btn-delete" onclick="deleteProject('${project.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        async function editProject(id) {
            try {
                const result = await window.apiClient.getProjects();
                const projects = result.success ? result.data : [];
                const project = projects.find(p => p.id === id);
                
                if (!project) return;

                currentEditProjectId = id;
                
                document.getElementById('projectTitle').value = project.title || '';
                document.getElementById('projectDescription').value = project.description || '';
                document.getElementById('projectCategory').value = project.category || 'Robotics';
                document.getElementById('projectStatus').value = project.status || 'completed';
                document.getElementById('projectGithubLink').value = project.githubLink || '';
                document.getElementById('projectLiveLink').value = project.liveLink || '';
                document.getElementById('projectCompletionDate').value = project.completionDate || '';

                if (project.image) {
                    document.getElementById('projectImageUrl').value = project.image;
                    document.getElementById('projectImagePreview').src = project.image;
                    document.getElementById('projectImagePreview').style.display = 'block';
                }

                if (project.teamMembers) {
                    document.getElementById('projectTeamMembers').value = project.teamMembers.join('\n');
                }

                projectTechnologies = project.technologies || [];
                const techContainer = document.getElementById('technologiesContainer');
                const techInput = document.getElementById('technologiesInput');
                renderTags(techContainer, projectTechnologies, techInput, (index) => {
                    projectTechnologies.splice(index, 1);
                    renderTags(techContainer, projectTechnologies, techInput);
                });

                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('Editing project', 'info');
            } catch (error) {
                console.error('Error editing project:', error);
            }
        }

        async function deleteProject(id) {
            if (!confirm('Are you sure you want to delete this project?')) return;

            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                localStorage.removeItem('cache_projects');
                localStorage.removeItem(STORAGE_KEYS.PROJECTS);

                await window.storage.deleteProject(id);
                showToast('Project deleted successfully', 'success');
                await loadProjects();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error deleting project:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting project', 'error');
                }
            }
        }

        function resetProjectForm() {
            document.getElementById('projectForm').reset();
            currentEditProjectId = null;
            projectTechnologies = [];
            document.getElementById('projectImagePreview').style.display = 'none';
            const techContainer = document.getElementById('technologiesContainer');
            const techInput = document.getElementById('technologiesInput');
            renderTags(techContainer, projectTechnologies, techInput, () => {});
        }

        function setupGalleryForm() {
            const form = document.getElementById('galleryForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveGalleryItem();
            });

            const searchInput = document.getElementById('gallerySearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    loadGallery(e.target.value);
                });
            }
        }

        // Helper function to convert image to Base64
        function imageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function saveGalleryItem() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const imageFileInput = document.getElementById('galleryImage');
                const imageFile = imageFileInput ? imageFileInput.files[0] : null;
                
                if (!imageFile) {
                    showToast('Please select an image', 'error');
                    return;
                }

                const title = document.getElementById('galleryTitle').value.trim();
                const category = document.getElementById('galleryCategory').value;
                const date = document.getElementById('galleryDate').value;

                if (!title || !category || !date) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                // Disable submit button
                const submitBtn = document.getElementById('gallerySubmitBtn');
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Processing...';

                // Show upload progress
                const progressDiv = document.getElementById('uploadProgress');
                const progressBar = document.getElementById('uploadProgressBar');
                const statusText = document.getElementById('uploadStatus');
                
                progressDiv.style.display = 'block';
                progressBar.style.width = '30%';
                statusText.textContent = `Preparing ${imageFile.name}...`;

                // Convert image to Base64
                console.log('üì± Converting image to base64...', imageFile.name, imageFile.size);
                const base64Image = await imageToBase64(imageFile);
                console.log('‚úÖ Base64 conversion complete, length:', base64Image.length);

                progressBar.style.width = '50%';
                statusText.textContent = 'Uploading to Cloudinary via backend...';

                // Get token
                const token = localStorage.getItem('grrc_auth_token') || sessionStorage.getItem('grrc_auth_token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                // Upload via backend with longer timeout for mobile
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 60000); // 60 second timeout
                
                const uploadResponse = await fetch(`${window.apiClient.baseURL}/api/upload/image`, {
                    signal: controller.signal,
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ image: base64Image })
                });
                
                clearTimeout(timeoutId);

                const uploadData = await uploadResponse.json();

                if (!uploadResponse.ok || !uploadData.success) {
                    throw new Error(uploadData.error || 'Upload failed');
                }

                console.log('‚úÖ Cloudinary upload successful:', uploadData.url);

                progressBar.style.width = '70%';
                statusText.textContent = 'Saving to database...';

                // Save to database with Cloudinary URL
                const galleryData = {
                    image: uploadData.url,
                    title: title,
                    category: category,
                    date: date,
                    description: document.getElementById('galleryDescription').value.trim(),
                    photographer: document.getElementById('galleryPhotographer').value.trim()
                };

                await window.storage.addGalleryItem(galleryData);
                
                localStorage.removeItem('cache_gallery');
                localStorage.removeItem(STORAGE_KEYS.GALLERY);
                localStorage.removeItem('gallery');

                progressBar.style.width = '100%';
                statusText.textContent = '‚úÖ Upload complete!';
                
                showToast('Gallery item added successfully!', 'success');
                
                resetGalleryForm();
                await loadGallery();
                await loadDashboardStats();

            } catch (error) {
                console.error('‚ùå Error saving gallery item:', error);
                
                if (error.name === 'AbortError') {
                    showToast('Upload timeout - image may be too large. Try a smaller image.', 'error');
                } else if (error.message.includes('Authentication') || error.message.includes('401')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    showToast('Network error - check your connection and try again', 'error');
                } else {
                    showToast(error.message || 'Error saving gallery item', 'error');
                }
            } finally {
                const submitBtn = document.getElementById('gallerySubmitBtn');
                submitBtn.disabled = false;
                submitBtn.textContent = 'üíæ Add to Gallery';
                
                setTimeout(() => {
                    const progressDiv = document.getElementById('uploadProgress');
                    if (progressDiv) progressDiv.style.display = 'none';
                }, 3000);
            }
        }

        async function loadGallery(searchTerm = '') {
            try {
                console.log('üì∏ Loading gallery...');
                
                localStorage.removeItem('cache_gallery');
                localStorage.removeItem(STORAGE_KEYS.GALLERY);
                localStorage.removeItem('gallery');
                
                const result = await window.apiClient.getGallery();
                let gallery = [];

                if (result.success && Array.isArray(result.data)) {
                    gallery = result.data;
                    console.log('‚úÖ Gallery loaded:', gallery.length, 'items');
                } else {
                    console.warn('‚ùå API failed, using fallback');
                    gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
                }
                
                if (searchTerm) {
                    gallery = gallery.filter(g => 
                        g.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        g.category.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                const tbody = document.getElementById('galleryTableBody');
                
                if (!tbody) {
                    console.error('‚ùå Table not found!');
                    return;
                }
                
                if (gallery.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: var(--space-xl);">No gallery items found</td></tr>';
                    return;
                }

                tbody.innerHTML = gallery.map(item => `
                    <tr>
                        <td><img src="${item.image}" alt="${item.title}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"></td>
                        <td style="font-weight: 600;">${item.title}</td>
                        <td><span class="badge badge-info">${item.category}</span></td>
                        <td>${formatDate(item.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-delete" onclick="deleteGalleryItem('${item.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
                
                console.log('‚úÖ Gallery rendered!');
            } catch (error) {
                console.error('‚ùå Gallery error:', error);
                const tbody = document.getElementById('galleryTableBody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: red;">Error: ' + error.message + '</td></tr>';
                }
            }
        }

        async function deleteGalleryItem(id) {
            if (!confirm('Are you sure you want to delete this gallery item?')) return;

            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                localStorage.removeItem('cache_gallery');
                localStorage.removeItem(STORAGE_KEYS.GALLERY);

                await window.storage.deleteGalleryItem(id);
                showToast('Gallery item deleted successfully', 'success');
                await loadGallery();
                await loadDashboardStats();
            } catch (error) {
                console.error('Error deleting gallery item:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting gallery item', 'error');
                }
            }
        }

        function resetGalleryForm() {
            document.getElementById('galleryForm').reset();
            document.getElementById('galleryImagePreview').style.display = 'none';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('galleryCloudinaryUrl').value = '';
            
            const submitBtn = document.getElementById('gallerySubmitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = 'üíæ Add to Gallery';
        }

        function setupAnnouncementForm() {
            const form = document.getElementById('announcementForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                saveAnnouncement();
            });
        }

        async function saveAnnouncement() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const title = document.getElementById('announcementTitle').value.trim();
                const content = document.getElementById('announcementContent').value.trim();

                console.log('Announcement form values:', { title, content });

                if (!title || !content) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                const announcementData = {
                    title: title,
                    content: content,
                    priority: document.getElementById('announcementPriority').value,
                    date: new Date().toISOString()
                };

                console.log('Submitting announcement data:', announcementData);

                if (currentEditAnnouncementId) {
                    await window.storage.updateAnnouncement(currentEditAnnouncementId, announcementData);
                    showToast('Announcement updated!', 'success');
                } else {
                    await window.storage.addAnnouncement(announcementData);
                    showToast('Announcement added!', 'success');
                }

                localStorage.removeItem('cache_announcements');
                localStorage.removeItem(STORAGE_KEYS.ANNOUNCEMENTS);

                resetAnnouncementForm();
                await loadAnnouncements();
            } catch (error) {
                console.error('Error saving announcement:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error saving announcement', 'error');
                }
            }
        }

        async function loadAnnouncements() {
            try {
                localStorage.removeItem('cache_announcements');
                
                const result = await window.apiClient.getAnnouncements();
                let announcements = [];

                if (result.success && Array.isArray(result.data)) {
                    announcements = result.data;
                } else {
                    console.warn('API returned invalid data, using localStorage fallback:', result);
                    announcements = JSON.parse(localStorage.getItem('announcements')) || [];
                }

                const tbody = document.getElementById('announcementsTableBody');
                
                if (announcements.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: var(--space-xl);">No announcements yet</td></tr>';
                    return;
                }

                tbody.innerHTML = announcements.map(announcement => `
                    <tr>
                        <td style="font-weight: 600;">${announcement.title}</td>
                        <td><span class="badge ${announcement.priority === 'high' ? 'badge-warning' : 'badge-info'}">${announcement.priority}</span></td>
                        <td>${formatDate(announcement.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-edit" onclick="editAnnouncement('${announcement.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-icon btn-delete" onclick="deleteAnnouncement('${announcement.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading announcements:', error);
            }
        }

        async function editAnnouncement(id) {
            try {
                const result = await window.apiClient.getAnnouncements();
                const announcements = result.success ? result.data : [];
                const announcement = announcements.find(a => a.id === id);
                
                if (!announcement) return;

                currentEditAnnouncementId = id;
                
                document.getElementById('announcementTitle').value = announcement.title || '';
                document.getElementById('announcementContent').value = announcement.content || '';
                document.getElementById('announcementPriority').value = announcement.priority || 'normal';

                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('Editing announcement', 'info');
            } catch (error) {
                console.error('Error editing announcement:', error);
            }
        }

        async function deleteAnnouncement(id) {
            if (!confirm('Are you sure you want to delete this announcement?')) return;

            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                localStorage.removeItem('cache_announcements');
                localStorage.removeItem(STORAGE_KEYS.ANNOUNCEMENTS);

                await window.storage.deleteAnnouncement(id);
                showToast('Announcement deleted successfully', 'success');
                await loadAnnouncements();
            } catch (error) {
                console.error('Error deleting announcement:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting announcement', 'error');
                }
            }
        }

        function resetAnnouncementForm() {
            document.getElementById('announcementForm').reset();
            currentEditAnnouncementId = null;
        }

        function setupAdminForm() {
            const form = document.getElementById('adminForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                saveAdmin();
            });
        }

        async function saveAdmin() {
            try {
                if (!isAuthenticated()) {
                    showToast('Please log in again', 'error');
                    setTimeout(() => window.location.href = 'admin.html', 1000);
                    return;
                }

                const username = document.getElementById('adminUsername').value.trim();
                const password = document.getElementById('adminPassword').value;
                const confirmPassword = document.getElementById('adminPasswordConfirm').value;
                const role = document.getElementById('adminRole').value.trim();

                if (!username || !password || !confirmPassword || !role) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }

                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }

                const adminData = {
                    username: username,
                    password: password,
                    role: role
                };

                await window.storage.addAdmin(adminData);
                
                localStorage.removeItem('cache_admins');
                localStorage.removeItem(STORAGE_KEYS.ADMINS);
                
                showToast('Admin added successfully!', 'success');
                document.getElementById('adminForm').reset();
                await loadAdmins();
            } catch (error) {
                console.error('Error saving admin:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error saving admin', 'error');
                }
            }
        }

        async function loadAdmins() {
            try {
                localStorage.removeItem('cache_admins');
                
                const result = await window.apiClient.getAdmins();
                let admins = [];

                if (result.success && Array.isArray(result.data)) {
                    admins = result.data;
                } else {
                    console.warn('API returned invalid data, using localStorage fallback:', result);
                    admins = JSON.parse(localStorage.getItem('admins')) || [];
                }

                const tbody = document.getElementById('adminsTableBody');
                const currentAdmin = getCurrentAdmin();
                const currentAdminId = currentAdmin ? (currentAdmin.adminId || currentAdmin.id) : null;
                
                if (admins.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: var(--space-xl);">No admins found</td></tr>';
                    return;
                }

                tbody.innerHTML = admins.map(admin => `
                    <tr>
                        <td style="font-weight: 600;">${admin.username}</td>
                        <td><span class="badge badge-info">${admin.role}</span></td>
                        <td>${formatDate(admin.createdAt)}</td>
                        <td class="action-buttons">
                            ${currentAdminId && admin.id !== currentAdminId ? 
                                `<button class="btn btn-icon btn-delete" onclick="deleteAdmin('${admin.id}')">üóëÔ∏è</button>` : 
                                '<span style="color: var(--text-secondary); font-size: 0.875rem;">Current User</span>'}
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading admins:', error);
            }
        }

        async function deleteAdmin(id) {
    if (!confirm('Are you sure you want to delete this admin?')) return;

    try {
        if (!isAuthenticated()) {
            showToast('Please log in again', 'error');
            setTimeout(() => window.location.href = 'admin.html', 1000);
            return;
        }

        // Clear cache BEFORE checking if admin exists
        localStorage.removeItem('cache_admins');
        localStorage.removeItem(STORAGE_KEYS.ADMINS);

        const result = await window.apiClient.getAdmins();
        const admins = result.success ? result.data : [];
        const adminExists = admins.find(a => a.id === id);
        
        if (!adminExists) {
            console.warn('Admin not found in cached list, attempting delete anyway...');
            // Don't return - try delete anyway
        }

        await window.storage.deleteAdmin(id);
                showToast('Admin deleted successfully', 'success');
                await loadAdmins();
            } catch (error) {
                console.error('Error deleting admin:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast(error.message || 'Error deleting admin', 'error');
                }
            }
        }

        async function loadAllData() {
            const token = localStorage.getItem('grrc_auth_token');
            if (!token) {
                console.error('No auth token found');
                showToast('Not authenticated', 'error');
                setTimeout(() => window.location.href = 'admin.html', 1000);
                return;
            }

            try {
                console.log('Loading all data...');
                
                // Load data sequentially to avoid race conditions
                await loadMembers();
                await loadEvents();
                await loadProjects();
                await loadGallery();
                await loadAnnouncements();
                await loadAdmins();
                
                console.log('All data loaded successfully');
                
                // ‚úÖ CRITICAL FIX: Force dashboard stats reload after ALL data loads
                await new Promise(resolve => setTimeout(resolve, 300));
                await loadDashboardStats();
                
                console.log('‚úÖ Initial data load complete');
            } catch (error) {
                console.error('Error loading data:', error);
                
                if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                    showToast('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        sessionStorage.clear();
                        localStorage.removeItem('grrc_auth_token');
                        window.location.href = 'admin.html';
                    }, 2000);
                } else {
                    showToast('Some data failed to load. Check console for details.', 'error');
                }
            }
        }

        function getStatusBadgeClass(status) {
            const statusMap = {
                'upcoming': 'badge-info',
                'ongoing': 'badge-warning',
                'completed': 'badge-success',
                'cancelled': 'badge-error',
                'planned': 'badge-info'
            };
            return statusMap[status] || 'badge-info';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');

            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? '‚úì' : '‚úï';
            toast.className = `toast ${type === 'error' ? 'error' : ''} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function setupLogoutButton() {
            document.getElementById('logoutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    logout();
                }
            });
            
            // Setup Super Admin button - ONLY SHOW MODAL WHEN CLICKED
            const superAdminBtn = document.getElementById('superAdminBtn');
            if (superAdminBtn) {
                superAdminBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showSuperAdminModal();
                });
            }
        }

        async function navigateToSection(section) {
            console.log('üîÑ Navigating to section:', section);
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked nav item
            const navItem = document.querySelector(`[data-section="${section}"]`);
            if (navItem) {
                navItem.classList.add('active');
                console.log('‚úÖ Nav item activated:', section);
            } else {
                console.error('‚ùå Nav item not found for section:', section);
            }

            // Hide all section content
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show the selected section
            const sectionMap = {
                'dashboard': 'dashboardSection',
                'club-config': 'clubConfigSection',
                'members': 'membersSection',
                'events': 'eventsSection',
                'projects': 'projectsSection',
                'gallery': 'gallerySection',
                'announcements': 'announcementsSection',
                'membership-applications': 'membershipApplicationsSection',
                'alumni': 'alumniSection',
                'admins': 'adminsSection'
            };
            
            const sectionId = sectionMap[section];
            if (!sectionId) {
                console.error('‚ùå No section ID mapping found for:', section);
                return;
            }
            
            const sectionElement = document.getElementById(sectionId);
            if (sectionElement) {
                sectionElement.classList.add('active');
                console.log('‚úÖ Section displayed:', sectionId);
            } else {
                console.error('‚ùå Section element not found:', sectionId);
                return;
            }

            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'club-config': 'Club Configuration',
                'members': 'Manage Members',
                'events': 'Manage Events',
                'projects': 'Manage Projects',
                'gallery': 'Manage Gallery',
                'announcements': 'Manage Announcements',
                'membership-applications': 'Membership Applications',
                'alumni': 'Alumni Management',
                'admins': 'Manage Admins'
            };
            
            const titleElement = document.getElementById('sectionTitle');
            if (titleElement) {
                titleElement.textContent = titles[section] || 'Admin Panel';
            }

            currentSection = section;

            // Close mobile sidebar
            const sidebar = document.getElementById('adminSidebar');
            if (sidebar) {
                sidebar.classList.remove('mobile-open');
            }

            // Load section-specific data
            console.log('üìä Loading data for section:', section);
            if (section === 'dashboard') {
                // ‚úÖ CRITICAL FIX: Force fresh stats load with delay to ensure DOM ready
                setTimeout(async () => {
                    await loadDashboardStats();
                    await loadAdminDashboardInfo();
                }, 100);
            }
            if (section === 'club-config') {
                console.log('üîÑ Loading club config section...');
                await loadClubConfig();
            }
            if (section === 'members') {
                await loadMembers();
                setTimeout(() => loadDashboardStats(), 500);
            }
            if (section === 'events') {
                await loadEvents();
                setTimeout(() => loadDashboardStats(), 500);
            }
            if (section === 'projects') {
                await loadProjects();
                setTimeout(() => loadDashboardStats(), 500);
            }
            if (section === 'gallery') {
                await loadGallery();
                setTimeout(() => loadDashboardStats(), 500);
            }
            if (section === 'announcements') {
                await loadAnnouncements();
                setTimeout(() => loadDashboardStats(), 500);
            }
            if (section === 'admins') loadAdmins();
            
           // Load iframe content for new sections
if (section === 'membership-applications') {
    const iframe = document.getElementById('membershipIframe');
    if (iframe && iframe.contentWindow) {
        console.log('üîÑ Reloading membership iframe...');
        // ‚úÖ CRITICAL FIX: Ensure token is available in both places
        try {
            const token = window.apiClient ? window.apiClient.getAuthToken() : localStorage.getItem('grrc_auth_token');
            if (token) {
                console.log('üîê Token available for iframe');
                // Token will be read by iframe from localStorage
            } else {
                console.error('‚ùå No token found for iframe');
            }
        } catch (e) {
            console.warn('Could not verify iframe token:', e);
        }
        iframe.contentWindow.location.reload();
                    // Update dashboard stat after reload
                    setTimeout(async () => {
                        try {
                            const stats = await window.apiClient.getMembershipStatistics();
                            if (stats.success && stats.data) {
                                document.getElementById('statPendingApplications').textContent = stats.data.pending || 0;
                            }
                        } catch (error) {
                            console.error('Error updating pending applications stat:', error);
                        }
                    }, 1000);
                }
            }
            // ‚úÖ CRITICAL FIX: Alumni section with token passing
            if (section === 'alumni') {
                const iframe = document.getElementById('alumniIframe');
                if (iframe && iframe.contentWindow) {
                    try {
                        const token = window.apiClient.getAuthToken();
                        if (token) {
                            // Wait for iframe to load
                            setTimeout(() => {
                                if (iframe.contentWindow.apiClient) {
                                    iframe.contentWindow.apiClient.setAuthToken(token);
                                }
                                iframe.contentWindow.location.reload();
                            }, 500);
                        }
                    } catch (e) {
                        console.warn('Could not set alumni iframe token:', e);
                    }
                }
            }
        }

        function setupMobileSidebar() {
            const toggle = document.getElementById('mobileSidebarToggle');
            const sidebar = document.getElementById('adminSidebar');

            toggle.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });

            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }

        function setupForms() {
            setupClubConfigForm();
            setupMemberForm();
            setupEventForm();
            setupProjectForm();
            setupGalleryForm();
            setupAnnouncementForm();
            setupAdminForm();
            setupImagePreviews();
            setupTagsInput();
        }

        function setupImagePreviews() {
            const imageInputs = [
                { file: 'logoInput', url: 'logoUrl', preview: 'logoPreview' },
                { file: 'memberPhoto', url: 'memberPhotoUrl', preview: 'memberPhotoPreview' },
                { file: 'eventImage', url: 'eventImageUrl', preview: 'eventImagePreview' },
                { file: 'projectImage', url: 'projectImageUrl', preview: 'projectImagePreview' },
                { file: 'galleryImage', url: 'galleryImageUrl', preview: 'galleryImagePreview' }
            ];

            imageInputs.forEach(input => {
                const fileInput = document.getElementById(input.file);
                const urlInput = document.getElementById(input.url);
                const preview = document.getElementById(input.preview);

                if (fileInput) {
                    fileInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const base64 = await imageToBase64(file);
                            if (preview) {
                                preview.src = base64;
                                preview.style.display = 'block';
                            }
                        }
                    });
                }

                if (urlInput && preview) {
                    urlInput.addEventListener('input', (e) => {
                        if (e.target.value) {
                            preview.src = e.target.value;
                            preview.style.display = 'block';
                        } else {
                            preview.style.display = 'none';
                        }
                    });
                }
            });
        }

        function setupTagsInput() {
            const skillsInput = document.getElementById('skillsInput');
            const skillsContainer = document.getElementById('skillsContainer');

            if (skillsInput && skillsContainer) {
                skillsInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const value = skillsInput.value.trim();
                        if (value && !memberSkills.includes(value)) {
                            memberSkills.push(value);
                            renderTags(skillsContainer, memberSkills, skillsInput, (index) => {
                                memberSkills.splice(index, 1);
                                renderTags(skillsContainer, memberSkills, skillsInput);
                            });
                            skillsInput.value = '';
                        }
                    }
                });
            }

            const techInput = document.getElementById('technologiesInput');
            const techContainer = document.getElementById('technologiesContainer');

            if (techInput && techContainer) {
                techInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const value = techInput.value.trim();
                        if (value && !projectTechnologies.includes(value)) {
                            projectTechnologies.push(value);
                            renderTags(techContainer, projectTechnologies, techInput, (index) => {
                                projectTechnologies.splice(index, 1);
                                renderTags(techContainer, projectTechnologies, techInput);
                            });
                            techInput.value = '';
                        }
                    }
                });
            }
        }

        function renderTags(container, tags, input, onRemove) {
            const existingTags = container.querySelectorAll('.tag');
            existingTags.forEach(tag => tag.remove());

            tags.forEach((tag, index) => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag';
                tagEl.innerHTML = `${tag} <span class="tag-remove" data-index="${index}">√ó</span>`;
                container.insertBefore(tagEl, input);

                tagEl.querySelector('.tag-remove').addEventListener('click', () => {
                    onRemove(index);
                });
            });
        }

       function setupClubConfigForm() {
    const form = document.getElementById('clubConfigForm');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        try {
            if (!isAuthenticated()) {
                showToast('Please log in again', 'error');
                setTimeout(() => window.location.href = 'admin.html', 1000);
                return;
            }

            const logoFile = document.getElementById('logoInput').files[0];
            const logoUrl = document.getElementById('logoUrl').value.trim();
            let logo = logoUrl;

            if (logoFile) {
                logo = await imageToBase64(logoFile);
            }

            const bkashNumber = document.getElementById('bkashNumber').value.trim();
            const membershipFee = parseInt(document.getElementById('membershipFee').value.trim());

            // Validate bKash number
            const bkashPattern = /^(\+8801|01)[3-9]\d{8}$/;
            if (!bkashPattern.test(bkashNumber)) {
                showToast('Invalid bKash number format. Use +8801XXXXXXXXX or 01XXXXXXXXX', 'error');
                return;
            }

            // Validate membership fee
            if (isNaN(membershipFee) || membershipFee < 0) {
                showToast('Invalid membership fee. Must be a positive number', 'error');
                return;
            }

            console.log('üíæ Saving config with payment settings:', {
                bkash: bkashNumber,
                fee: membershipFee
            });

             const socialLinksArray = [];
            const socials = ['facebook', 'twitter', 'instagram', 'linkedin', 'youtube', 'github', 'email'];
            socials.forEach(platform => {
                const value = document.getElementById(`social${platform.charAt(0).toUpperCase() + platform.slice(1)}`).value.trim();
                if (value) {
                    socialLinksArray.push({ platform, url: value });
                }
            });
            
            console.log('üîó Social links collected:', socialLinksArray);

            const config = {
                logo: logo,
                club_name: document.getElementById('clubName').value.trim(),
                club_motto: document.getElementById('clubMotto').value.trim(),
                club_description: document.getElementById('clubDescription').value.trim(),
                bkash_number: bkashNumber,
                membership_fee: membershipFee,
                social_links: socialLinksArray,
                socialLinks: socialLinksArray // CRITICAL: Add both field names for compatibility
            };

            // Show saving toast
            showToast('Saving configuration...', 'info');
            
            console.log('üíæ Attempting to save config:', JSON.stringify(config, null, 2));

            // ‚úÖ CRITICAL FIX: Clear ALL possible cache locations BEFORE save
            console.log('üóëÔ∏è Clearing all config caches...');
            localStorage.removeItem('cache_clubConfig');
            localStorage.removeItem('clubConfig');
            if (typeof STORAGE_KEYS !== 'undefined') {
                localStorage.removeItem(STORAGE_KEYS.CLUB_CONFIG);
            }
            
            // Clear service worker cache if exists
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        if (name.includes('config')) {
                            caches.delete(name);
                        }
                    });
                });
            }

            // Save to backend with error handling
            let saveResult;
            try {
                console.log('üì§ Sending config to API:', JSON.stringify(config, null, 2));
                saveResult = await setClubConfig(config);
                
                if (!saveResult || !saveResult.success) {
                    throw new Error(saveResult?.error || 'Backend save returned unsuccessful');
                }
                
                console.log('‚úÖ Config saved successfully to backend:', saveResult);
            } catch (saveError) {
                console.error('‚ùå Save failed:', saveError);
                showToast(`Failed to save: ${saveError.message}`, 'error');
                return; // Stop here if save failed
            }

            // ‚úÖ CRITICAL FIX: Force immediate cache update with saved data
            console.log('üíæ Force-writing config to all cache locations...');
            const savedConfig = saveResult.data || config;
            localStorage.setItem(STORAGE_KEYS.CLUB_CONFIG, JSON.stringify(savedConfig));
            localStorage.setItem('clubConfig', JSON.stringify(savedConfig));
            localStorage.setItem('cache_clubConfig', JSON.stringify(savedConfig));
            console.log('‚úÖ Payment settings cached:', {
                bkash: savedConfig.bkash_number,
                fee: savedConfig.membership_fee
            });

            // ‚úÖ CRITICAL FIX: Update sidebar UI with cache-busting
            const sidebarLogo = document.getElementById('sidebarLogo');
            const sidebarSubtitle = document.querySelector('.admin-subtitle');

            if (sidebarLogo && savedConfig.logo) {
                const logoUrl = savedConfig.logo.includes('?') 
                    ? savedConfig.logo + '&t=' + Date.now()
                    : savedConfig.logo + '?t=' + Date.now();
                sidebarLogo.src = logoUrl;
                console.log('‚úÖ Sidebar logo updated');
            }

            if (sidebarSubtitle && (savedConfig.club_name || savedConfig.name)) {
                sidebarSubtitle.textContent = savedConfig.club_name || savedConfig.name;
                console.log('‚úÖ Sidebar name updated');
            }

            showToast('Configuration saved successfully!', 'success');

            // ‚úÖ FIX: Keep form data populated after save
            // Update form fields with saved data to prevent clearing
            document.getElementById('clubName').value = savedConfig.club_name || savedConfig.name || config.club_name;
            document.getElementById('clubMotto').value = savedConfig.club_motto || config.club_motto;
            document.getElementById('clubDescription').value = savedConfig.club_description || config.club_description;
            document.getElementById('bkashNumber').value = savedConfig.bkash_number || config.bkash_number;
            document.getElementById('membershipFee').value = savedConfig.membership_fee || config.membership_fee;
            
            // Update preview images if they exist
            const logoPreview = document.getElementById('logoPreview');
            if (logoPreview && savedConfig.logo) {
                const previewUrl = savedConfig.logo.includes('?') 
                    ? savedConfig.logo + '&t=' + Date.now()
                    : savedConfig.logo + '?t=' + Date.now();
                logoPreview.src = previewUrl;
                logoPreview.style.display = 'block';
            }

            // Re-trigger a data load for the club config section to show updates
            setTimeout(() => {
                loadClubConfig();
            }, 500);

        } catch (error) {
            console.error('Error saving config:', error);
            
            if (error.message.includes('Authentication') || error.message.includes('401') || error.message.includes('Unauthorized')) {
                showToast('Session expired. Please log in again.', 'error');
                setTimeout(() => {
                    sessionStorage.clear();
                    localStorage.removeItem('grrc_auth_token');
                    window.location.href = 'admin.html';
                }, 2000);
            } else {
                showToast(error.message || 'Error saving configuration', 'error');
            }
        }
    });
}

        async function loadClubConfig() {
            try {
                console.log('üîÑ Loading club config with forced cache bypass...');
                
                // ‚úÖ CRITICAL: Clear ALL cache locations
                localStorage.removeItem('cache_clubConfig');
                localStorage.removeItem('clubConfig');
                if (typeof STORAGE_KEYS !== 'undefined') {
                    localStorage.removeItem(STORAGE_KEYS.CLUB_CONFIG);
                }
                
                // ‚úÖ CRITICAL FIX: Force fresh API call with cache-busting
                const timestamp = Date.now();
                const result = await window.apiClient.request(`/api/content/config?_t=${timestamp}`, {
                    method: 'GET',
                    cache: 'no-store'
                });
                
                console.log('üì¶ Raw API response:', result);
                
                if (result.success && result.data) {
                    const config = result.data;
                    console.log('üìã Config data received:', {
                        club_name: config.club_name,
                        name: config.name,
                        bkash_number: config.bkash_number,
                        membership_fee: config.membership_fee,
                        fullConfig: config
                    });

                    // ‚úÖ CRITICAL: Use correct field names from backend
                    const logoValue = config.logo_url || config.logo;
                    if (logoValue) {
                        document.getElementById('logoUrl').value = logoValue;
                        const preview = document.getElementById('logoPreview');
                        
                        // ‚úÖ FIX: Don't add cache-busting to base64 data URLs
                        if (logoValue.startsWith('data:')) {
                            preview.src = logoValue;
                        } else {
                            preview.src = logoValue + '?t=' + Date.now();
                        }
                        
                        preview.style.display = 'block';
                        preview.onerror = function() {
                            this.src = 'assets/default-logo.jpg';
                        };
                    }

                    // ‚úÖ CRITICAL: Field name mapping from backend response
                    document.getElementById('clubName').value = config.club_name || config.name || 'GSTU Robotics & Research Club';
                    document.getElementById('clubMotto').value = config.club_motto || config.motto || '';
                    document.getElementById('clubDescription').value = config.club_description || config.description || '';
                    
                    // ‚úÖ CRITICAL: Load payment settings
                    const bkashValue = config.bkash_number || '01712345678';
                    const feeValue = config.membership_fee || 500;
                    
                    console.log('üí∞ Payment settings loaded:', {
                        bkash: bkashValue,
                        fee: feeValue
                    });
                    
                    document.getElementById('bkashNumber').value = bkashValue;
                    document.getElementById('membershipFee').value = feeValue;

                    // ‚úÖ Load social links
                    const links = config.social_links || [];
                    console.log('üîó Social links:', links);
                    
                    // Clear all fields first
                    ['facebook', 'twitter', 'instagram', 'linkedin', 'youtube', 'github', 'email'].forEach(platform => {
                        const inputId = `social${platform.charAt(0).toUpperCase() + platform.slice(1)}`;
                        const input = document.getElementById(inputId);
                        if (input) input.value = '';
                    });
                    
                    // Populate with data
                    if (Array.isArray(links)) {
                        links.forEach(link => {
                            const inputId = `social${link.platform.charAt(0).toUpperCase() + link.platform.slice(1)}`;
                            const input = document.getElementById(inputId);
                            if (input) input.value = link.url;
                        });
                    }
                    
                    console.log('‚úÖ Form populated successfully');
                }
            } catch (error) {
                console.error('‚ùå Error loading club config:', error);
                showToast('Error loading configuration', 'error');
                // Set defaults on error
                document.getElementById('bkashNumber').value = '01712345678';
                document.getElementById('membershipFee').value = 500;
            }
        }

        function setupMemberForm() {
            const form = document.getElementById('memberForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveMember();
            });
        }

        // ========== SUPER ADMIN ACCESS FUNCTIONS ==========
        
        function showSuperAdminModal() {
            const modal = document.getElementById('superAdminModal');
            modal.style.display = 'block';
            document.getElementById('superAdminPassword').value = '';
            document.getElementById('superAdminPassword').focus();
            const errorDiv = document.getElementById('superAdminError');
            errorDiv.style.display = 'none';
        }
        
        function closeSuperAdminModal() {
            const modal = document.getElementById('superAdminModal');
            if (modal) {
                modal.style.display = 'none';
                document.getElementById('superAdminPassword').value = '';
                const errorDiv = document.getElementById('superAdminError');
                if (errorDiv) errorDiv.style.display = 'none';
            }
        }
        
        document.getElementById('superAdminVerificationForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            await verifySuperAdminPassword();
        });
        
        async function verifySuperAdminPassword() {
            const passwordField = document.getElementById('superAdminPassword');
            const errorDiv = document.getElementById('superAdminError');
            const password = passwordField.value.trim();
            
            if (!password) {
                errorDiv.textContent = 'Password is required';
                errorDiv.style.display = 'block';
                passwordField.focus();
                return;
            }
            
            try {
                console.log('üîê Verifying super admin password...');
                
                // Use dedicated verify-superadmin endpoint
                const result = await window.apiClient.request('/api/auth/verify-superadmin', {
                    method: 'POST',
                    body: JSON.stringify({ password: password })
                });
                
                if (result.success && result.data && result.data.token) {
                    console.log('‚úÖ Super admin verification successful!');
                    
                    localStorage.setItem('superAdminToken', result.data.token);
                    closeSuperAdminModal();
                    showToast('Access granted! Redirecting...', 'success');
                    
                    setTimeout(() => {
                        const basePath = window.location.pathname.includes('/grrc-website/') ? '/grrc-website/' : './';
                        window.location.href = basePath + 'super-admin-panel.html';
                    }, 1000);
                    
                } else {
                    console.error('‚ùå Verification failed - not super admin');
                    errorDiv.textContent = 'Invalid password or you are not a Super Admin';
                    errorDiv.style.display = 'block';
                    passwordField.value = '';
                    passwordField.focus();
                }
                
            } catch (error) {
                console.error('‚ùå Super admin verification error:', error);
                errorDiv.textContent = 'Verification failed: ' + (error.message || 'Unknown error');
                errorDiv.style.display = 'block';
                passwordField.value = '';
                passwordField.focus();
            }
        }
        
        // Close modal on outside click
        const superAdminModalEl = document.getElementById('superAdminModal');
        if (superAdminModalEl) {
            superAdminModalEl.addEventListener('click', (e) => {
                if (e.target.id === 'superAdminModal') {
                    closeSuperAdminModal();
                }
            });
        }
        
        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('superAdminModal');
            if (e.key === 'Escape' && modal && modal.style.display === 'flex') {
                closeSuperAdminModal();
            }
        });
    </script>
</body>
</html>